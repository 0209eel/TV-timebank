<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å®¶åº­ç§¯åˆ†é“¶è¡Œ - çœ‹ç”µè§†æ—¶é—´å…‘æ¢ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        vintage: {
                            cream: '#F5F1E8',
                            beige: '#E8DFC8',
                            tan: '#D4C4A8',
                            brown: '#8B6F4E',
                            rust: '#B85C38',
                            orange: '#D97B4D',
                            green: '#4A5D4E',
                            dark: '#3A3329',
                            paper: '#FAF8F3'
                        }
                    },
                    fontFamily: {
                        sans: ['DM Sans', 'Noto Sans SC', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #F5F1E8;
            background-image: 
                radial-gradient(#D4C4A8 1px, transparent 1px),
                radial-gradient(#D4C4A8 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            font-family: 'DM Sans', 'Noto Sans SC', sans-serif;
        }
        
        .vintage-card {
            background: #FAF8F3;
            box-shadow: 
                0 4px 0 #D4C4A8,
                0 8px 16px rgba(139, 111, 78, 0.15);
            border: 2px solid #E8DFC8;
            transition: all 0.2s ease;
        }
        
        .vintage-card:active {
            transform: translateY(4px);
            box-shadow: 
                0 0 0 #D4C4A8,
                0 2px 8px rgba(139, 111, 78, 0.1);
        }
        
        .vintage-btn {
            background: #4A5D4E;
            color: #FAF8F3;
            box-shadow: 0 4px 0 #3A4A3E;
            transition: all 0.15s ease;
        }
        
        .vintage-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #3A4A3E;
        }
        
        .vintage-btn-rust {
            background: #B85C38;
            color: #FAF8F3;
            box-shadow: 0 4px 0 #8B4513;
        }
        
        .vintage-btn-rust:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #8B4513;
        }
        
        .vintage-btn-orange {
            background: #D97B4D;
            color: #FAF8F3;
            box-shadow: 0 4px 0 #B85C38;
        }
        
        .vintage-btn-orange:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #B85C38;
        }
        
        .stamp-border {
            border: 3px dashed #B85C38;
            border-radius: 16px;
            position: relative;
        }
        
        .stamp-border::before {
            content: 'âœ“';
            position: absolute;
            top: -12px;
            left: 20px;
            background: #FAF8F3;
            padding: 0 8px;
            color: #B85C38;
            font-weight: bold;
            font-size: 14px;
        }
        
        .number-display {
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.02em;
        }
        
        .texture-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            z-index: 50;
        }
        
        .mode-switch {
            background: #E8DFC8;
            border-radius: 50px;
            padding: 4px;
            position: relative;
        }
        
        .mode-indicator {
            position: absolute;
            top: 4px;
            left: 4px;
            height: calc(100% - 8px);
            background: #4A5D4E;
            border-radius: 50px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(74, 93, 78, 0.3);
        }
        
        .ticket-notch {
            position: relative;
        }
        
        .ticket-notch::before,
        .ticket-notch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: #F5F1E8;
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .ticket-notch::before {
            left: -10px;
            box-shadow: inset -2px 0 4px rgba(0,0,0,0.1);
        }
        
        .ticket-notch::after {
            right: -10px;
            box-shadow: inset 2px 0 4px rgba(0,0,0,0.1);
        }
        
        .wavy-line {
            background-image: repeating-linear-gradient(
                90deg,
                #B85C38,
                #B85C38 8px,
                transparent 8px,
                transparent 12px
            );
            height: 2px;
            border: none;
        }
        
        .typewriter {
            border-right: 2px solid #B85C38;
            animation: blink 1s step-end infinite;
        }
        
        @keyframes blink {
            50% { border-color: transparent; }
        }
        
        .counter-box {
            background: #3A3329;
            color: #E8DFC8;
            font-family: 'Courier New', monospace;
            border-radius: 8px;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .history-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .history-scroll::-webkit-scrollbar-track {
            background: #E8DFC8;
            border-radius: 3px;
        }
        
        .history-scroll::-webkit-scrollbar-thumb {
            background: #B85C38;
            border-radius: 3px;
        }
    </style>
<base target="_blank">
</head>
<body class="text-vintage-dark min-h-screen pb-8">

    <div class="texture-overlay"></div>

    <div class="relative z-10 max-w-md mx-auto px-4 pt-6">
        
        <!-- å¤å¤æ ‡é¢˜åŒº -->
        <header class="mb-6 text-center">
            <div class="inline-block bg-vintage-cream border-2 border-vintage-brown px-6 py-2 rounded-full mb-3 shadow-md">
                <span class="text-vintage-brown font-bold text-sm tracking-widest uppercase">EST. 2024</span>
            </div>
            <h1 class="text-4xl font-black text-vintage-dark mb-1 tracking-tight" style="text-shadow: 2px 2px 0 #D4C4A8;">
                å®¶åº­ç§¯åˆ†é“¶è¡Œ
            </h1>
            <p class="text-vintage-brown font-medium text-sm italic">Family Time Exchange System</p>
            <div class="wavy-line w-32 mx-auto mt-3"></div>
        </header>

        <!-- å¤å¤ä½™é¢æ˜¾ç¤º -->
        <div class="vintage-card rounded-2xl p-6 mb-6 ticket-notch relative overflow-hidden">
            <div class="absolute top-0 right-0 bg-vintage-rust text-vintage-paper text-xs font-bold px-3 py-1 rounded-bl-lg">
                NO. <span id="ticketNumber">001</span>
            </div>
            
            <div class="text-center mb-4">
                <p class="text-vintage-brown text-sm font-bold uppercase tracking-wider mb-2">Current Balance</p>
                <div class="counter-box inline-block px-6 py-3 text-4xl font-bold number-display mb-2" id="totalMinutes">
                    0
                </div>
                <p class="text-vintage-dark font-bold text-lg">åˆ†é’Ÿ <span class="text-vintage-brown text-sm font-normal">min</span></p>
            </div>

            <div class="flex justify-between items-center text-sm border-t-2 border-dashed border-vintage-tan pt-3">
                <span class="text-vintage-brown">â‰ˆ <span id="hoursDisplay">0</span>å°æ—¶<span id="minsDisplay">0</span>åˆ†</span>
                <span class="text-vintage-rust font-bold" id="statusText">ä½™é¢å……è¶³</span>
            </div>
        </div>

        <!-- æ¨¡å¼åˆ‡æ¢ -->
        <div class="mode-switch flex relative mb-6 shadow-inner">
            <div id="modeIndicator" class="mode-indicator" style="width: calc(50% - 4px)"></div>
            <button onclick="switchMode('earn')" id="earnBtn" class="flex-1 py-3 px-4 rounded-full text-sm font-bold relative z-10 text-vintage-paper transition-colors">
                èµšå–æ—¶é—´
            </button>
            <button onclick="switchMode('spend')" id="spendBtn" class="flex-1 py-3 px-4 rounded-full text-sm font-bold relative z-10 text-vintage-brown transition-colors">
                æ¶ˆè€—æ—¶é—´
            </button>
        </div>

        <!-- èµšå–æ¨¡å¼ -->
        <div id="earnView" class="space-y-4">
            
            <!-- è¯»ä¹¦ä»»åŠ¡ - æ ¸å¿ƒä¿®æ”¹ -->
            <div class="vintage-card rounded-2xl p-5">
                <div class="flex items-start gap-4 mb-4">
                    <div class="w-12 h-12 bg-vintage-green rounded-xl flex items-center justify-center text-vintage-paper text-2xl shadow-md flex-shrink-0">
                        ğŸ“š
                    </div>
                    <div class="flex-1">
                        <h3 class="font-bold text-vintage-dark text-lg leading-tight">è¯»ä¹¦ä»»åŠ¡</h3>
                        <p class="text-vintage-brown text-xs mt-1 leading-relaxed">
                            æŒ‰æ—¶å®Œæˆã€è®¤çœŸè¯»ä¹¦<br>
                            <span class="text-vintage-rust font-bold">æ— æé†’ +10åˆ† | æé†’1æ¬¡ +5åˆ† | æé†’2æ¬¡ 0åˆ†</span>
                        </p>
                    </div>
                </div>

                <!-- è¯»ä¹¦ä»»åŠ¡é€‰é¡¹ -->
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="addReadingTime(10)" class="vintage-btn py-3 px-2 rounded-xl font-bold text-sm">
                        æ— æé†’<br>+10åˆ†
                    </button>
                    <button onclick="addReadingTime(5)" class="vintage-btn-orange py-3 px-2 rounded-xl font-bold text-sm">
                        æé†’1æ¬¡<br>+5åˆ†
                    </button>
                    <button onclick="addReadingTime(0)" class="bg-vintage-tan text-vintage-dark py-3 px-2 rounded-xl font-bold text-sm shadow-md border-2 border-vintage-brown">
                        æé†’2æ¬¡<br>0åˆ†
                    </button>
                </div>
            </div>

            <!-- å°æç´+ç»ƒå­— -->
            <div class="vintage-card rounded-2xl p-5 cursor-pointer" onclick="addTime(10, 'å°æç´+ç»ƒå­—', 'violin')">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-vintage-rust rounded-xl flex items-center justify-center text-vintage-paper text-2xl shadow-md">
                        ğŸ»
                    </div>
                    <div class="flex-1">
                        <h3 class="font-bold text-vintage-dark text-lg">å°æç´ + ç»ƒå­—</h3>
                        <p class="text-vintage-brown text-xs">ç»ƒç´30åˆ†é’Ÿ + ç»ƒå­—ä¸€ç¯‡</p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-black text-vintage-rust">+10</div>
                        <div class="text-xs text-vintage-brown">åˆ†é’Ÿ</div>
                    </div>
                </div>
            </div>

            <!-- é˜…è¯»+æˆ·å¤– -->
            <div class="vintage-card rounded-2xl p-5 cursor-pointer" onclick="addTime(10, 'é˜…è¯»+æˆ·å¤–æ´»åŠ¨', 'outdoor')">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-vintage-green rounded-xl flex items-center justify-center text-vintage-paper text-2xl shadow-md">
                        ğŸŒ²
                    </div>
                    <div class="flex-1">
                        <h3 class="font-bold text-vintage-dark text-lg">é˜…è¯» + æˆ·å¤–æ´»åŠ¨</h3>
                        <p class="text-vintage-brown text-xs">è¯¾å¤–ä¹¦30åˆ†é’Ÿ + æˆ·å¤–30åˆ†é’Ÿ</p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-black text-vintage-green">+10</div>
                        <div class="text-xs text-vintage-brown">åˆ†é’Ÿ</div>
                    </div>
                </div>
            </div>

            <!-- è‡ªç†èƒ½åŠ› -->
            <div class="vintage-card rounded-2xl p-5">
                <div class="flex items-start gap-4 mb-4">
                    <div class="w-12 h-12 bg-vintage-orange rounded-xl flex items-center justify-center text-vintage-paper text-2xl shadow-md flex-shrink-0">
                        ğŸ§¹
                    </div>
                    <div class="flex-1">
                        <h3 class="font-bold text-vintage-dark text-lg">è‡ªç†èƒ½åŠ› + å®¶åŠ¡</h3>
                        <p class="text-vintage-brown text-xs mt-1">
                            åˆ·ç‰™æ´—è„¸ +2åˆ† | æ´—è¢œå­/å®¶åŠ¡ +5åˆ†<br>
                            <span class="text-vintage-rust">æ¯æ—¥ä¸Šé™10åˆ†</span>
                        </p>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="addSelfCare(2)" class="vintage-btn-orange py-3 rounded-xl font-bold text-sm">
                        åˆ·ç‰™æ´—è„¸ +2åˆ†
                    </button>
                    <button onclick="addSelfCare(5)" class="vintage-btn py-3 rounded-xl font-bold text-sm">
                        æ´—è¢œå­/å®¶åŠ¡ +5åˆ†
                    </button>
                </div>
                <div class="mt-2 text-center">
                    <span class="text-xs text-vintage-brown bg-vintage-beige px-3 py-1 rounded-full">
                        ä»Šæ—¥å·²è·: <span id="selfCareToday" class="font-bold text-vintage-rust">0</span>/10 åˆ†
                    </span>
                </div>
            </div>

            <!-- è‡ªå®šä¹‰æ·»åŠ  -->
            <div class="stamp-border p-1 rounded-2xl">
                <button onclick="showCustomAdd()" class="w-full py-4 bg-vintage-cream rounded-xl font-bold text-vintage-brown border-2 border-dashed border-vintage-brown hover:bg-vintage-beige transition-colors flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                    è‡ªå®šä¹‰æ·»åŠ æ—¶é—´
                </button>
            </div>
        </div>

        <!-- æ¶ˆè€—æ¨¡å¼ -->
        <div id="spendView" class="hidden space-y-4">
            <div class="vintage-card rounded-2xl p-6">
                <div class="text-center mb-6">
                    <div class="w-20 h-20 bg-vintage-rust rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg text-4xl">
                        ğŸ“º
                    </div>
                    <h3 class="text-xl font-bold text-vintage-dark">æ¶ˆè€—çœ‹ç”µè§†æ—¶é—´</h3>
                    <p class="text-vintage-brown text-sm">è¾“å…¥å®é™…è§‚çœ‹çš„åˆ†é’Ÿæ•°</p>
                </div>

                <div class="space-y-4">
                    <div class="counter-box p-4 text-center">
                        <input type="number" id="spendInput" value="30" 
                            class="bg-transparent text-center text-3xl font-bold w-full focus:outline-none text-vintage-paper placeholder-vintage-tan"
                            min="1">
                    </div>

                    <div class="grid grid-cols-4 gap-2">
                        <button onclick="adjustSpend(-10)" class="py-2 bg-vintage-beige rounded-lg font-bold text-vintage-brown hover:bg-vintage-tan">-10</button>
                        <button onclick="setSpend(15)" class="py-2 bg-vintage-beige rounded-lg font-bold text-vintage-brown hover:bg-vintage-tan">15</button>
                        <button onclick="setSpend(30)" class="py-2 bg-vintage-beige rounded-lg font-bold text-vintage-brown hover:bg-vintage-tan">30</button>
                        <button onclick="adjustSpend(10)" class="py-2 bg-vintage-beige rounded-lg font-bold text-vintage-brown hover:bg-vintage-tan">+10</button>
                    </div>

                    <button onclick="confirmSpend()" class="w-full vintage-btn-rust py-4 rounded-xl font-bold text-lg">
                        ç¡®è®¤æ‰£é™¤æ—¶é—´
                    </button>
                </div>
            </div>
        </div>

        <!-- å†å²è®°å½• -->
        <div class="mt-6 vintage-card rounded-2xl p-4">
            <div class="flex justify-between items-center mb-3 border-b-2 border-vintage-beige pb-2">
                <h4 class="font-bold text-vintage-dark flex items-center gap-2">
                    <span class="w-2 h-2 bg-vintage-rust rounded-full"></span>
                    ä»Šæ—¥è®°å½•
                </h4>
                <button onclick="clearHistory()" class="text-xs text-vintage-rust font-bold hover:underline">æ¸…ç©º</button>
            </div>
            <div id="historyList" class="space-y-2 max-h-40 overflow-y-auto history-scroll pr-1">
                <div class="text-center text-vintage-brown text-sm py-4 italic">æš‚æ— è®°å½•</div>
            </div>
        </div>

        <!-- é¡µè„š -->
        <div class="text-center mt-6 text-vintage-brown text-xs">
            <p>Keep track of time, make every minute count</p>
            <p class="mt-1 opacity-60">Â© 2024 Family Bank</p>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰æ·»åŠ å¼¹çª— -->
    <div id="customModal" class="fixed inset-0 bg-vintage-dark/80 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="vintage-card rounded-2xl p-6 w-full max-w-sm relative">
            <button onclick="closeModal()" class="absolute top-3 right-3 w-8 h-8 bg-vintage-beige rounded-full flex items-center justify-center text-vintage-brown font-bold">Ã—</button>
            
            <h3 class="text-xl font-bold text-vintage-dark mb-4 text-center border-b-2 border-vintage-beige pb-2">è‡ªå®šä¹‰æ·»åŠ </h3>
            
            <div class="mb-4">
                <label class="block text-sm font-bold text-vintage-brown mb-2">åˆ†é’Ÿæ•°</label>
                <div class="counter-box p-3">
                    <input type="number" id="customInput" value="10" 
                        class="bg-transparent text-center text-3xl font-bold w-full focus:outline-none text-vintage-paper"
                        min="1" max="60">
                </div>
            </div>

            <div class="grid grid-cols-4 gap-2 mb-4">
                <button onclick="setCustom(5)" class="py-2 bg-vintage-beige rounded-lg font-bold text-vintage-brown text-sm hover:bg-vintage-tan">5</button>
                <button onclick="setCustom(10)" class="py-2 bg-vintage-beige rounded-lg font-bold text-vintage-brown text-sm hover:bg-vintage-tan">10</button>
                <button onclick="setCustom(15)" class="py-2 bg-vintage-beige rounded-lg font-bold text-vintage-brown text-sm hover:bg-vintage-tan">15</button>
                <button onclick="setCustom(20)" class="py-2 bg-vintage-beige rounded-lg font-bold text-vintage-brown text-sm hover:bg-vintage-tan">20</button>
            </div>

            <button onclick="confirmCustom()" class="w-full vintage-btn py-3 rounded-xl font-bold">
                ç¡®è®¤æ·»åŠ 
            </button>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨
        let totalMinutes = parseInt(localStorage.getItem('tvTimeTotal_v2')) || 0;
        let history = JSON.parse(localStorage.getItem('tvTimeHistory_v2')) || [];
        let selfCareToday = 0;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateDisplay();
            renderHistory();
            updateSelfCareDisplay();
            
            // æ£€æŸ¥æ—¥æœŸé‡ç½®
            const lastDate = localStorage.getItem('tvTimeLastDate_v2');
            const today = new Date().toDateString();
            if (lastDate !== today) {
                localStorage.setItem('tvTimeLastDate_v2', today);
                selfCareToday = 0;
            } else {
                calculateSelfCareToday();
            }
        });

        // è®¡ç®—ä»Šæ—¥è‡ªç†èƒ½åŠ›åˆ†
        function calculateSelfCareToday() {
            const today = new Date().toDateString();
            selfCareToday = history
                .filter(h => h.type === 'selfcare' && h.date === today && h.minutes > 0)
                .reduce((sum, h) => sum + h.minutes, 0);
            updateSelfCareDisplay();
        }

        function updateSelfCareDisplay() {
            document.getElementById('selfCareToday').textContent = selfCareToday;
        }

        // åˆ‡æ¢æ¨¡å¼
        function switchMode(mode) {
            const indicator = document.getElementById('modeIndicator');
            const earnBtn = document.getElementById('earnBtn');
            const spendBtn = document.getElementById('spendBtn');
            const earnView = document.getElementById('earnView');
            const spendView = document.getElementById('spendView');

            if (mode === 'earn') {
                indicator.style.transform = 'translateX(0)';
                earnBtn.classList.replace('text-vintage-brown', 'text-vintage-paper');
                spendBtn.classList.replace('text-vintage-paper', 'text-vintage-brown');
                earnView.classList.remove('hidden');
                spendView.classList.add('hidden');
            } else {
                indicator.style.transform = 'translateX(calc(100% + 4px))';
                earnBtn.classList.replace('text-vintage-paper', 'text-vintage-brown');
                spendBtn.classList.replace('text-vintage-brown', 'text-vintage-paper');
                earnView.classList.add('hidden');
                spendView.classList.remove('hidden');
            }
        }

        // è¯»ä¹¦ä»»åŠ¡é€»è¾‘
        function addReadingTime(minutes) {
            let description = '';
            if (minutes === 10) description = 'è¯»ä¹¦ä»»åŠ¡-æ— æé†’';
            else if (minutes === 5) description = 'è¯»ä¹¦ä»»åŠ¡-æé†’1æ¬¡';
            else description = 'è¯»ä¹¦ä»»åŠ¡-æé†’2æ¬¡(æ— å¥–åŠ±)';
            
            addTime(minutes, description, 'reading');
            
            // è§†è§‰åé¦ˆ
            if (minutes > 0) {
                showToast(`è·å¾— ${minutes} åˆ†é’Ÿï¼`);
            } else {
                showToast('å·²å®Œæˆï¼Œä½†æ— å¥–åŠ±æ—¶é—´');
            }
        }

        // é€šç”¨æ·»åŠ æ—¶é—´
        function addTime(minutes, description, type) {
            totalMinutes += minutes;
            
            const today = new Date().toDateString();
            const record = {
                date: today,
                time: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' }),
                task: description,
                minutes: minutes,
                type: type || 'custom',
                balance: totalMinutes
            };
            
            history.unshift(record);
            if (history.length > 30) history.pop();
            
            // å¦‚æœæ˜¯è‡ªç†èƒ½åŠ›ï¼Œæ›´æ–°ä»Šæ—¥ç»Ÿè®¡
            if (type === 'selfcare') {
                selfCareToday += minutes;
                updateSelfCareDisplay();
            }
            
            saveData();
            updateDisplay();
            renderHistory();
        }

        // è‡ªç†èƒ½åŠ›ç‰¹æ®Šå¤„ç†ï¼ˆä¸Šé™æ£€æŸ¥ï¼‰
        function addSelfCare(minutes) {
            if (selfCareToday + minutes > 10) {
                alert(`ä»Šæ—¥è‡ªç†èƒ½åŠ›å¥–åŠ±å·²è¾¾ä¸Šé™ï¼\nå½“å‰ï¼š${selfCareToday}åˆ†é’Ÿï¼Œä¸Šé™ï¼š10åˆ†é’Ÿ`);
                return;
            }
            addTime(minutes, minutes === 2 ? 'åˆ·ç‰™æ´—è„¸' : 'æ´—è¢œå­/å®¶åŠ¡', 'selfcare');
            showToast(`+${minutes} åˆ†é’Ÿï¼`);
        }

        // æ¶ˆè€—æ—¶é—´
        function adjustSpend(delta) {
            const input = document.getElementById('spendInput');
            let val = parseInt(input.value) || 0;
            val = Math.max(1, val + delta);
            input.value = val;
        }

        function setSpend(val) {
            document.getElementById('spendInput').value = val;
        }

        function confirmSpend() {
            const minutes = parseInt(document.getElementById('spendInput').value) || 0;
            if (minutes <= 0) return;
            
            if (minutes > totalMinutes) {
                if (confirm(`æ—¶é—´ä¸è¶³ï¼å½“å‰ä½™é¢${totalMinutes}åˆ†é’Ÿï¼Œç¡®å®šå…¨éƒ¨ç”¨å®Œå—ï¼Ÿ`)) {
                    addTime(-totalMinutes, 'çœ‹ç”µè§†/ç©æ‰‹æœº(å…¨éƒ¨ç”¨å®Œ)', 'spend');
                    document.getElementById('spendInput').value = 30;
                }
            } else {
                addTime(-minutes, 'çœ‹ç”µè§†/ç©æ‰‹æœº', 'spend');
                document.getElementById('spendInput').value = 30;
                showToast(`å·²æ‰£é™¤ ${minutes} åˆ†é’Ÿ`);
            }
        }

        // è‡ªå®šä¹‰æ·»åŠ 
        function showCustomAdd() {
            document.getElementById('customModal').classList.remove('hidden');
            document.getElementById('customModal').classList.add('flex');
            document.getElementById('customInput').focus();
        }

        function closeModal() {
            document.getElementById('customModal').classList.add('hidden');
            document.getElementById('customModal').classList.remove('flex');
        }

        function setCustom(val) {
            document.getElementById('customInput').value = val;
        }

        function confirmCustom() {
            const minutes = parseInt(document.getElementById('customInput').value) || 0;
            if (minutes <= 0) return;
            addTime(minutes, 'è‡ªå®šä¹‰æ·»åŠ ', 'custom');
            closeModal();
            showToast(`+${minutes} åˆ†é’Ÿï¼`);
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            document.getElementById('totalMinutes').textContent = totalMinutes;
            
            const hours = Math.floor(totalMinutes / 60);
            const mins = totalMinutes % 60;
            document.getElementById('hoursDisplay').textContent = hours;
            document.getElementById('minsDisplay').textContent = mins;
            
            // çŠ¶æ€æ–‡æœ¬
            const statusEl = document.getElementById('statusText');
            if (totalMinutes >= 60) {
                statusEl.textContent = 'ä½™é¢å……è¶³';
                statusEl.className = 'text-vintage-green font-bold';
            } else if (totalMinutes >= 30) {
                statusEl.textContent = 'ä½™é¢ä¸€èˆ¬';
                statusEl.className = 'text-vintage-orange font-bold';
            } else if (totalMinutes > 0) {
                statusEl.textContent = 'ä½™é¢ä¸è¶³';
                statusEl.className = 'text-vintage-rust font-bold';
            } else {
                statusEl.textContent = 'éœ€èµšå–æ—¶é—´';
                statusEl.className = 'text-vintage-brown font-bold';
            }
            
            // ç¥¨å·
            document.getElementById('ticketNumber').textContent = 
                String(history.length + 1).padStart(3, '0');
        }

        // æ¸²æŸ“å†å²
        function renderHistory() {
            const list = document.getElementById('historyList');
            if (history.length === 0) {
                list.innerHTML = '<div class="text-center text-vintage-brown text-sm py-4 italic">æš‚æ— è®°å½•</div>';
                return;
            }
            
            list.innerHTML = history.map((h, i) => {
                const isPositive = h.minutes > 0;
                return `
                <div class="flex justify-between items-center p-3 bg-vintage-cream rounded-lg border border-vintage-beige text-sm">
                    <div class="flex items-center gap-2">
                        <span class="w-1.5 h-1.5 rounded-full ${isPositive ? 'bg-vintage-green' : 'bg-vintage-rust'}"></span>
                        <div>
                            <div class="font-bold text-vintage-dark text-xs">${h.task}</div>
                            <div class="text-vintage-brown text-xs">${h.time}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold ${isPositive ? 'text-vintage-green' : 'text-vintage-rust'} text-sm">
                            ${isPositive ? '+' : ''}${h.minutes}
                        </div>
                        <div class="text-vintage-brown text-xs">ä½™${h.balance}</div>
                    </div>
                </div>
                `;
            }).join('');
        }

        // æ¸…ç©ºå†å²
        function clearHistory() {
            if (confirm('ç¡®å®šæ¸…ç©ºä»Šæ—¥è®°å½•ï¼Ÿæ—¶é—´ä½™é¢å°†ä¿ç•™ã€‚')) {
                history = [];
                selfCareToday = 0;
                updateSelfCareDisplay();
                saveData();
                renderHistory();
                updateDisplay();
            }
        }

        // ä¿å­˜æ•°æ®
        function saveData() {
            localStorage.setItem('tvTimeTotal_v2', totalMinutes);
            localStorage.setItem('tvTimeHistory_v2', JSON.stringify(history));
        }

        // æç¤º
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-20 left-1/2 transform -translate-x-1/2 bg-vintage-dark text-vintage-paper px-6 py-3 rounded-full shadow-2xl z-50 font-bold text-sm border-2 border-vintage-brown';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(-50%) translateY(-10px)';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        // é”®ç›˜æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });
    </script>
</body>
</html>